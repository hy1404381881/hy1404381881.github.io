<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>用户管理</title>
<!-- Tell the browser to be responsive to screen width -->
<meta
	content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
	name="viewport">
<!-- Bootstrap 3.3.7 -->
<link rel="stylesheet"
	href="../../admin/bower_components/bootstrap/dist/css/bootstrap.min.css">
<!-- Font Awesome -->
<link rel="stylesheet"
	href="../../admin/bower_components/font-awesome/css/font-awesome.min.css">
<!-- Ionicons -->
<link rel="stylesheet"
	href="../../admin/bower_components/Ionicons/css/ionicons.min.css">
<!-- jvectormap -->
<link rel="stylesheet"
	href="../../admin/bower_components/jvectormap/jquery-jvectormap.css">
<!-- Theme style -->
<link rel="stylesheet" href="../../admin/dist/css/AdminLTE.min.css">
<!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
<link rel="stylesheet"
	href="../../admin/dist/css/skins/_all-skins.min.css">
<link rel="stylesheet"
	href="../../plugins/bootstrap-table/dist/bootstrap-table.min.css">
<link rel="stylesheet"
	href="../../plugins/codeseven-toastr/build/toastr.min.css">
<link rel="stylesheet"
	href="../../plugins/bootstrapvalidator-master/dist/css/bootstrapValidator.min.css">
<link type="image/png" href="../../images/favicon.png"
	rel="shortcut icon">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

<!-- Google Font -->
<link rel="stylesheet"
	href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
</head>

<body class="hold-transition skin-blue sidebar-mini">
	<div class="wrapper">
		<header class="main-header"> </header>
		<!-- Left side column. contains the logo and sidebar -->
		<aside class="main-sidebar">
			<!-- sidebar: style can be found in sidebar.less -->
			<section class="sidebar">
				<ul class="sidebar-menu" data-widget="tree">
				</ul>
			</section>
		</aside>

		<!-- Content Wrapper. Contains page content -->
		<div class="content-wrapper">
			<!-- Content Header (Page header) -->
			<section class="content-header">
				<div class="box box-normal">
					<div class="box-header with-border">
						<h3 class="box-title">信息检索</h3>
					</div>
					<div class="box-body">
						<div class="row">
							<div class="col-xs-3">
								<input name="loginName" type="text" class="form-control"
									placeholder="登录名">
							</div>
							<div class="col-xs-3">
								<input name="name" type="text" class="form-control"
									placeholder="用户名">
							</div>
							<div class="col-xs-3">
								<input name="mobile" type="text" class="form-control"
									placeholder="手机号">
							</div>
							<div class="col-xs-3">
								<button id="btn_search" type="button"
									class="btn btn-info pull-left">搜索</button>
							</div>
						</div>
					</div>
					<!-- /.box-body -->
				</div>

			</section>

			<!-- Main content -->
			<section class="content">
				<!--list-->
				<div id="toolbar" class="btn-group">
					<button id="btn_add" type="button" class="btn btn-default">
						<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增
					</button>
					<button id="btn_edit" type="button" class="btn btn-default">
						<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>修改
					</button>
					<button id="btn_delete" type="button" class="btn btn-default">
						<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除
					</button>
				</div>
				<table id="tbData"></table>
		</div>
		<!--add-->
		<div class="modal fade" id="myModalAdd" tabindex="-1" role="dialog"
			aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal"
							aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title" id="myModalLabel">新增</h4>
					</div>
					<div class="modal-body">
						<form id="formAdd">
							<div class="form-group">
								<label>登录名</label> <input type="text" name="loginName"
									class="form-control" placeholder="登录名">
							</div>
							<div class="form-group">
								<label>用户名</label> <input type="text" name="name"
									class="form-control" placeholder="用户名">
							</div>
							<div class="form-group">
								<label>手机号</label> <input type="text" name="mobile"
									class="form-control" placeholder="手机号">
							</div>
							<div class="form-group">
								<label>密码</label> <input type="password" name="password"
									class="form-control" placeholder="密码">
							</div>
							<div class="form-group">
								<label>确认密码</label> <input type="password" name="repassword"
									class="form-control" placeholder="确认密码">
							</div>
							<div class="form-group">
								<label>备注</label> <input type="text" name="remark"
									class="form-control" placeholder="备注">
							</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">
							<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>关闭
						</button>
						<button type="button" id="btn_add_submit" class="btn btn-primary">
							<span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>保存
						</button>
					</div>
					</form>
				</div>
			</div>
		</div>
		<!--edit-->
		<div class="modal fade" id="myModalEdit" tabindex="-1" role="dialog"
			aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal"
							aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title" id="myModalLabel">编辑</h4>
					</div>
					<div class="modal-body">
						<form id="formEdit">
							<div class="form-group hidden">
								<label>记录id</label> <input type="text" name="id"
									class="form-control" placeholder="记录id">
							</div>
							<div class="form-group">
								<label>登录名</label> <input type="text" name="loginName"
									class="form-control" placeholder="登录名">
							</div>
							<div class="form-group">
								<label>用户名</label> <input type="text" name="name"
									class="form-control" placeholder="用户名">
							</div>
							<div class="form-group">
								<label>手机号</label> <input type="text" name="mobile"
									class="form-control" placeholder="手机号">
							</div>
							<div class="form-group">
								<label>密码</label> <input type="password" name="password"
									class="form-control" placeholder="密码">
							</div>
							<div class="form-group">
								<label>备注</label> <input type="text" name="remark"
									class="form-control" placeholder="备注">
							</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">
							<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>关闭
						</button>
						<button type="button" id="btn_edit_submit" class="btn btn-primary">
							<span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>修改
						</button>
					</div>
					</form>
				</div>
			</div>
		</div>
		</section>
		<!-- /.content -->
	</div>
	<!-- /.content-wrapper -->
	<footer class="main-footer"> </footer>

	<!-- Control Sidebar -->
	<aside class="control-sidebar control-sidebar-dark"></aside>
	<!-- /.control-sidebar -->
	<!-- Add the sidebar's background. This div must be placed
       immediately after the control sidebar -->
	<div class="control-sidebar-bg"></div>
	</div>
	<!-- ./wrapper -->

	<!-- jQuery 3 -->
	<script src="../../admin/bower_components/jquery/dist/jquery.min.js"></script>
	<!-- Bootstrap 3.3.7 -->
	<script
		src="../../admin/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
	<!--bootstrap table-->
	<script src="../../plugins/bootstrap-table/dist/bootstrap-table.min.js"></script>
	<script
		src="../../plugins/bootstrap-table/dist/locale/bootstrap-table-zh-CN.min.js"></script>
	<script src="../../plugins/codeseven-toastr/build/toastr.min.js"></script>
	<script
		src="../../plugins/bootstrapvalidator-master/dist/js/bootstrapValidator.min.js"></script>
	<!-- FastClick -->
	<script src="../../admin/bower_components/fastclick/lib/fastclick.js"></script>
	<!-- AdminLTE App -->
	<script src="../../admin/dist/js/adminlte.min.js"></script>
	<!-- Sparkline -->
	<script
		src="../../admin/bower_components/jquery-sparkline/dist/jquery.sparkline.min.js"></script>
	<!-- jvectormap  -->
	<script
		src="../../admin/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
	<script
		src="../../admin/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
	<!-- SlimScroll -->
	<script
		src="../../admin/bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
	<!-- ChartJS -->
	<script src="../../admin/bower_components/chart.js/Chart.js"></script>
	<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
	<script src="../../admin/dist/js/pages/dashboard2.js"></script>
	<!-- AdminLTE for demo purposes -->
	<script src="../../admin/dist/js/demo.js"></script>
	<script src="../../js/jquery.cookie/jquery.cookie.js"></script>
	<script src="../../js/base.js"></script>
	<script src="../../js/style/index.js"></script>
	<script>
    $(function () {
      //1.初始化Table
      new TableInit().Init();
      //验证add表单
      formValidator();
    });
    //定义表单验证
    function formValidator() {
      $('#formAdd').bootstrapValidator({
        message: 'This value is not valid',
        feedbackIcons: {/*input状态样式图片*/
          valid: 'glyphicon glyphicon-ok',
          invalid: 'glyphicon glyphicon-remove',
          validating: 'glyphicon glyphicon-refresh'
        },
        fields: {/*验证：规则*/
          loginName: {//验证input项：验证规则
            message: 'The loginName is not valid',
            validators: {
              notEmpty: {//非空验证：提示消息
                message: '登录名不能为空'
              },
              stringLength: {
                min: 6,
                max: 30,
                message: '登录名长度必须在6到30之间'
              },
              regexp: {
                regexp: /^[a-zA-Z0-9_\.]+$/,
                message: '登录名由数字字母下划线和.组成'
              }
            }
          },
          name: {//验证input项：验证规则
            message: 'The name is not valid',
            validators: {
              notEmpty: {//非空验证：提示消息
                message: '用户名不能为空'
              },
              stringLength: {
                min: 6,
                max: 30,
                message: '用户名长度必须在6到30之间'
              },
              regexp: {
                regexp: /^[a-zA-Z0-9_\.]+$/,
                message: '用户名由数字字母下划线和.组成'
              }
            }
          },
          mobile: {
            message: 'The phone is not valid',
            validators: {
              notEmpty: {
                message: '手机号码不能为空'
              },
              stringLength: {
                min: 11,
                max: 11,
                message: '请输入11位手机号码'
              },
              regexp: {
                regexp: /^1[3|5|8]{1}[0-9]{9}$/,
                message: '请输入正确的手机号码'
              }
            }
          },
          password: {
            message: '密码无效',
            validators: {
              notEmpty: {
                message: '密码不能为空'
              },
              stringLength: {
                min: 6,
                max: 30,
                message: '密码长度必须在6到30之间'
              },
              identical: {//相同
                field: 'password', //需要进行比较的input name值
                message: '两次密码不一致'
              },
              different: {//不能和用户名相同
                field: 'username',//需要进行比较的input name值
                message: '不能和用户名相同'
              },
              regexp: {
                regexp: /^[a-zA-Z0-9_\.]+$/,
                message: 'The username can only consist of alphabetical, number, dot and underscore'
              }
            }
          },
          repassword: {
            message: '密码无效',
            validators: {
              notEmpty: {
                message: '密码不能为空'
              },
              stringLength: {
                min: 6,
                max: 30,
                message: '用户名长度必须在6到30之间'
              },
              identical: {//相同
                field: 'password',
                message: '两次密码不一致'
              },
              different: {//不能和用户名相同
                field: 'username',
                message: '不能和用户名相同'
              },
              regexp: {//匹配规则
                regexp: /^[a-zA-Z0-9_\.]+$/,
                message: 'The username can only consist of alphabetical, number, dot and underscore'
              }
            }
          },
          remark: {//验证input项：验证规则
            message: 'The remark is not valid',
            validators: {
              notEmpty: {//非空验证：提示消息
                message: '备注不能为空'
              },
              stringLength: {
                min: 6,
                max: 30,
                message: '备注长度必须在6到30之间'
              }
            }
          },
        }
      })
      $('#formEdit').bootstrapValidator({
        message: 'This value is not valid',
        feedbackIcons: {/*input状态样式图片*/
          valid: 'glyphicon glyphicon-ok',
          invalid: 'glyphicon glyphicon-remove',
          validating: 'glyphicon glyphicon-refresh'
        },
        fields: {/*验证：规则*/
          loginName: {//验证input项：验证规则
            message: 'The loginName is not valid',
            validators: {
              notEmpty: {//非空验证：提示消息
                message: '登录名不能为空'
              },
              stringLength: {
                min: 6,
                max: 30,
                message: '登录名长度必须在6到30之间'
              },
              regexp: {
                regexp: /^[a-zA-Z0-9_\.]+$/,
                message: '登录名由数字字母下划线和.组成'
              }
            }
          },
          name: {//验证input项：验证规则
            message: 'The name is not valid',
            validators: {
              notEmpty: {//非空验证：提示消息
                message: '用户名不能为空'
              },
              stringLength: {
                min: 6,
                max: 30,
                message: '用户名长度必须在6到30之间'
              },
              regexp: {
                regexp: /^[a-zA-Z0-9_\.]+$/,
                message: '用户名由数字字母下划线和.组成'
              }
            }
          },
          mobile: {
            message: 'The phone is not valid',
            validators: {
              notEmpty: {
                message: '手机号码不能为空'
              },
              stringLength: {
                min: 11,
                max: 11,
                message: '请输入11位手机号码'
              },
              regexp: {
                regexp: /^1[3|5|8]{1}[0-9]{9}$/,
                message: '请输入正确的手机号码'
              }
            }
          },
          password: {
            message: '密码无效',
            validators: {
              notEmpty: {
                message: '密码不能为空'
              },
              stringLength: {
                min: 6,
                max: 30,
                message: '密码长度必须在6到30之间'
              },
              identical: {//相同
                field: 'password', //需要进行比较的input name值
                message: '两次密码不一致'
              },
              different: {//不能和用户名相同
                field: 'username',//需要进行比较的input name值
                message: '不能和用户名相同'
              },
              regexp: {
                regexp: /^[a-zA-Z0-9_\.]+$/,
                message: 'The username can only consist of alphabetical, number, dot and underscore'
              }
            }
          },
          remark: {//验证input项：验证规则
            message: 'The remark is not valid',
            validators: {
              notEmpty: {//非空验证：提示消息
                message: '备注不能为空'
              },
              stringLength: {
                min: 6,
                max: 30,
                message: '备注长度必须在6到30之间'
              }
            }
          },
        }
      })

    }
    //定义表格对象
    var TableInit = function () {
      var oTableInit = new Object();
      //初始化Table
      oTableInit.Init = function () {
        $('#tbData').bootstrapTable({
          url: app_url.manage.userList,         //请求后台的URL（*）
          method: 'get',                      //请求方式（*）
          toolbar: '#toolbar',                //工具按钮用哪个容器
          striped: true,                      //是否显示行间隔色
          cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
          pagination: true,                   //是否显示分页（*）
          sortable: false,                     //是否启用排序
          sortOrder: "asc",                   //排序方式          
          sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
          pageNumber: 1,                       //初始化加载第一页，默认第一页
          pageSize: 10,                       //每页的记录行数（*）
          pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
          paginationPreText: "上一页",
          paginationNextText: "下一页",
          paginationFirstText: "首页",
          paginationLastText: "尾页",
          //search: true,                       //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
          strictSearch: true,
          showColumns: true,                  //是否显示所有的列
          showRefresh: true,                  //是否显示刷新按钮
          minimumCountColumns: 2,             //最少允许的列数
          clickToSelect: true,                //是否启用点击选中行
          // height: 600,                     //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
          uniqueId: "id",                     //每一行的唯一标识，一般为主键列
          // showToggle: true,                    //是否显示详细视图和列表视图的切换按钮
          cardView: false,                    //是否显示详细视图
          detailView: false,                   //是否显示父子表
          ajaxOptions: { headers: { "Authorization": token } },//前后端分离情况下tokeny头验证
          queryParams: oTableInit.queryParams,//传递参数（*）
          columns: [{
            field: 'id',
            title: '',
            valign: "middle",
            align: "center",
            colspan: 1,
            width: 40,
            formatter: (value, row, index) => {
              return '<input name="id" type="checkbox" value="' + value + '" />'

            }
          }, {
            field: 'loginName',
            title: '登录名'
          }, {
            field: 'name',
            title: '用户名'
          }, {
            field: 'mobile',
            title: '手机号'
          }]
        });
      };
      //得到查询的参数
      oTableInit.queryParams = function (params) {
        return {
          limit: params.limit,   //页面大小
          offset: params.offset,  //偏移量
          loginName: $('input[name="loginName"]').val(),
          name: $('input[name="name"]').val(),
          mobile: $('input[name="mobile"]').val()
        }
      };
      return oTableInit;
    };
    //检索
    $("#btn_search").click(function () {
      $('#tbData').bootstrapTable('refresh');
    })
    //新增按钮
    $("#btn_add").click(function () {
      $('#myModalAdd').modal("show");
    })
    //编辑按钮
    $("#btn_edit").click(function () {
      var chooseLength = $('input[name="id"]:checked').length;
      if (chooseLength == 0) {
        toastr.warning('请勾选要修改的数据');
        return;
      }
      else if (chooseLength >= 2) {
        toastr.warning('请选择单条数据进行修改');
        return;
      }
      //构造请求参数
      tokenAjaxObj.url = app_url.manage.user_get + $('input[name="id"]:checked').val();
      tokenAjaxObj.type = "get";
      function callbackaddsuccess(obj) {
        //赋值
        $.setForm('#formEdit', obj.data);
        //显示窗口
        $('#myModalEdit').modal("show");
        //回复默认请求参数
        tokenAjaxObjToNormal();
      }
      tokenAjax(tokenAjaxObj, callbackaddsuccess);

    })
    //删除按钮
    $("#btn_delete").click(function () {
      var chooseLength = $('input[name="id"]:checked').length;
      if (chooseLength == 0) {
        toastr.warning('请勾选要删除的数据');
        return;
      }
      var ids = "";
      $('input[name="id"]:checked').each(function () {
        ids = ids + $(this).val() + ",";
      });
      ids = ids.trim(',');      
      tokenAjaxObj.url = app_url.manage.user_delete+ids;
      tokenAjaxObj.type="post";
      function callbackaddsuccess(obj) {
        toastr.success('删除数据成功');//提示框  
        $('#tbData').bootstrapTable('refresh');
      }
      function callbackaddfailure(obj) {
        toastr.error('数据删除失败');
      }
      Ewin.confirm({ message: "确认要删除选择的数据吗？" }).on(function (e) {
        if (!e) {
          return;
        }
        tokenAjax(tokenAjaxObj, callbackaddsuccess, callbackaddfailure);
      });


    });
    //新增提交
    $("#btn_add_submit").click(function () {
      $("#formAdd").bootstrapValidator('validate');//提交验证      
      tokenAjaxObj.data = arrayToJson($('#formAdd').serializeArray());//序列化表单
      tokenAjaxObj.url = app_url.manage.userAdd;
      function callbackaddsuccess(obj) {
        $("#myModalAdd").modal('hide');  //手动关闭        
        toastr.success('提交数据成功');//提示框       
        clearForm("#myModalAdd");//清空数据和验证
      }
      function callbackaddfailure(obj) {
        toastr.error('数据提交失败');
      }
      tokenAjax(tokenAjaxObj, callbackaddsuccess, callbackaddfailure);
    })
    //编辑提交    
    $("#btn_edit_submit").click(function () {
      $("#formAdd").bootstrapValidator('validate');//提交验证    
      tokenAjaxObj.data = arrayToJson($('#formEdit').serializeArray());//序列化表单
      tokenAjaxObj.url = app_url.manage.user_update;
      function callbackaddsuccess(obj) {
        $("#myModalEdit").modal('hide');  //手动关闭
        toastr.success('提交数据成功');//提示框        
        clearForm("#myModalEdit");//清空数据和验证
      }
      function callbackaddfailure(obj) {
        toastr.error('数据提交失败');
      }
      tokenAjax(tokenAjaxObj, callbackaddsuccess, callbackaddfailure);
    })   
  </script>
</body>

</html>